{"version":3,"sources":["webpack://@fof/byobu/webpack/bootstrap","webpack://@fof/byobu/external \"flarum.core.compat['extend']\"","webpack://@fof/byobu/external \"flarum.core.compat['utils/ItemList']\"","webpack://@fof/byobu/external \"flarum.core.compat['components/Button']\"","webpack://@fof/byobu/external \"flarum.core.compat['models/User']\"","webpack://@fof/byobu/external \"flarum.core.compat['models/Discussion']\"","webpack://@fof/byobu/external \"flarum.core.compat['Model']\"","webpack://@fof/byobu/external \"flarum.core.compat['models/Group']\"","webpack://@fof/byobu/external \"flarum.core.compat['helpers/listItems']\"","webpack://@fof/byobu/external \"flarum.core.compat['components/DiscussionPage']\"","webpack://@fof/byobu/external \"flarum.core.compat['components/LinkButton']\"","webpack://@fof/byobu/external \"flarum.core.compat['helpers/highlight']\"","webpack://@fof/byobu/external \"flarum.core.compat['helpers/username']\"","webpack://@fof/byobu/external \"flarum.core.compat['utils/extract']\"","webpack://@fof/byobu/external \"flarum.core.compat['components/DiscussionList']\"","webpack://@fof/byobu/external \"flarum.core.compat['components/UserPage']\"","webpack://@fof/byobu/external \"flarum.core.compat['components/LogInModal']\"","webpack://@fof/byobu/external \"flarum.core.compat['components/Notification']\"","webpack://@fof/byobu/external \"flarum.core.compat['utils/classList']\"","webpack://@fof/byobu/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@fof/byobu/./src/forum/components/sources/UserSearchSource.js","webpack://@fof/byobu/./src/forum/components/sources/GroupSearchSource.js","webpack://@fof/byobu/./src/common/helpers/recipientLabel.js","webpack://@fof/byobu/./src/forum/components/RecipientSearch.js","webpack://@fof/byobu/./src/forum/components/AddRecipientModal.js","webpack://@fof/byobu/./src/forum/components/PrivateDiscussionComposer.js","webpack://@fof/byobu/./src/common/helpers/recipientCountLabel.js","webpack://@fof/byobu/./src/forum/addRecipientComposer.js","webpack://@fof/byobu/./src/common/helpers/recipientsLabel.js","webpack://@fof/byobu/./src/forum/addRecipientLabels.js","webpack://@fof/byobu/./src/forum/addRecipientsControl.js","webpack://@fof/byobu/./src/forum/addHasRecipientsBadge.js","webpack://@fof/byobu/./src/forum/addDiscussPrivatelyControl.js","webpack://@fof/byobu/./src/forum/addPrivacySetting.js","webpack://@fof/byobu/./src/forum/components/PrivateDiscussionList.js","webpack://@fof/byobu/./src/forum/components/PrivateDiscussionsUserPage.js","webpack://@fof/byobu/./src/forum/addPrivateDiscussionsPage.js","webpack://@fof/byobu/./src/forum/components/PrivateDiscussionNotification.js","webpack://@fof/byobu/./src/forum/components/PrivateDiscussionReplyNotification.js","webpack://@fof/byobu/./src/forum/components/PrivateDiscussionIndex.js","webpack://@fof/byobu/./src/forum/components/RecipientsModified.js","webpack://@fof/byobu/./src/forum/addPrivateDiscussionsToSessionDropdown.js","webpack://@fof/byobu/./src/forum/index.js","webpack://@fof/byobu/external \"flarum.core.compat['components/DiscussionComposer']\"","webpack://@fof/byobu/external \"flarum.core.compat['components/Modal']\"","webpack://@fof/byobu/external \"flarum.core.compat['components/Search']\"","webpack://@fof/byobu/external \"flarum.core.compat['helpers/avatar']\"","webpack://@fof/byobu/external \"flarum.core.compat['utils/extractText']\"","webpack://@fof/byobu/external \"flarum.core.compat['components/LoadingIndicator']\"","webpack://@fof/byobu/external \"flarum.core.compat['components/DiscussionListItem']\"","webpack://@fof/byobu/external \"flarum.core.compat['components/DiscussionHero']\"","webpack://@fof/byobu/external \"flarum.core.compat['utils/DiscussionControls']\"","webpack://@fof/byobu/external \"flarum.core.compat['components/Badge']\"","webpack://@fof/byobu/external \"flarum.core.compat['utils/UserControls']\"","webpack://@fof/byobu/external \"flarum.core.compat['components/SettingsPage']\"","webpack://@fof/byobu/external \"flarum.core.compat['components/Switch']\"","webpack://@fof/byobu/external \"flarum.core.compat['components/Dropdown']\"","webpack://@fof/byobu/external \"flarum.core.compat['components/NotificationGrid']\"","webpack://@fof/byobu/external \"flarum.core.compat['components/Page']\"","webpack://@fof/byobu/external \"flarum.core.compat['helpers/icon']\"","webpack://@fof/byobu/external \"flarum.core.compat['components/WelcomeHero']\"","webpack://@fof/byobu/external \"flarum.core.compat['components/Select']\"","webpack://@fof/byobu/external \"flarum.core.compat['components/SelectDropdown']\"","webpack://@fof/byobu/external \"flarum.core.compat['components/EventPost']\"","webpack://@fof/byobu/external \"flarum.core.compat['components/SessionDropdown']\"","webpack://@fof/byobu/./forum.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","flarum","core","compat","_inheritsLoose","subClass","superClass","constructor","__proto__","UserSearchSource","view","query","length","this","loading","app","cache","byobuResults","className","translator","trans","map","user","username","children","highlight","data-index","id","avatar","store","find","filter","q","page","limit","then","pushResults","results","payload","data","result","getById","push","redraw","GroupSearchSource","search","toLowerCase","all","group","namePlural","substr","groupName","class","recipientLabel","recipient","attrs","style","label","link","extract","User","title","href","route","config","Group","RecipientSearch","isInitialized","$search","$","on","e","target","addRecipient","focus","parentNode","clearTimeout","typingTimer","doSearch","setTimeout","sources","sourceItems","toArray","props","selected","onclick","removeRecipient","classList","open","focused","active","loadingSources","element","type","placeholder","extractText","oninput","withAttr","onfocus","hasFocus","onblur","in","source","LoadingIndicator","component","size","items","ItemList","discussion","forum","attribute","canEditUserRecipients","add","canEditGroupRecipients","clear","values","split","findRecipient","remove","Search","AddRecipientModal","init","prop","assignInitialRecipients","selectedRecipients","merge","session","recipientSearch","isDismissible","recipientUsers","recipientGroups","helpText","content","isDisabled","Button","disabled","icon","hide","select","metaKey","ctrlKey","indexOf","index","submit","onsubmit","preventDefault","recipients","forEach","save","relationships","current","DiscussionPage","stream","update","modal","close","composer","show","strategy","Modal","PrivateDiscussionComposer","chooseRecipients","param","addDefaultRecipients","createRecord","discussionList","addDiscussion","loaded","DiscussionComposer","recipientCountLabel","count","transChoice","recipientsLabel","extend","DiscussionControls","canEditRecipients","addHasRecipientsBadge","Discussion","badges","Badge","UserControls","blocksPd","cannotBeDirectMessaged","deferred","titlePlaceholder","submitLabel","load","resolve","promise","SettingsPage","Switch","state","preferences","onchange","preferenceSaver","PrivateDiscussionList","DiscussionList","PrivateDiscussionsUserPage","changeSort","duser","list","params","sort","refresh","handleChangeSort","loadUser","newDiscussionAction","reject","LogInModal","listItems","actionItems","viewItems","render","canStartDiscussion","itemClassName","sortMap","sortOptions","Dropdown","buttonClassName","keys","UserPage","Number","routes","path","LinkButton","PrivateDiscussionNotification","notification","subject","fromUser","Notification","PrivateDiscussionReplyNotification","postNumber","PrivateDiscussionIndex","previous","lastDiscussion","privateDiscussionList","some","history","bodyClass","onunload","scrollTop","window","hero","sidebarItems","context","arguments","css","setTitle","setTitleCount","oldHeroHeight","heroHeight","outerHeight","height","scroll","$discussion","indexTop","indexBottom","discussionTop","offset","top","discussionBottom","WelcomeHero","newDiscussion","SelectDropdown","navItems","stickyParams","Select","options","markAllAsRead","searching","clearSearch","routeName","composeNewDiscussion","onlogin","confirm","readTime","Date","Page","RecipientsModified","initProps","diff","diff1","diff2","item","post","usersAdded","usersRemoved","groupsAdded","groupsRemoved","added","concat","removed","oldRecipients","newRecipients","descriptionKey","localeBase","descriptionData","EventPost","SessionDropdown","initializers","addToDiscussion","private_discussions","Model","hasMany","oldRecipientUsers","oldRecipientGroups","postComponents","recipientsModified","getBy","users","groups","addRecipientComposer","long","DiscussionListItem","include","DiscussionHero","addRecipientsControl","addPrivacySetting","addDiscussPrivatelyControl","addPrivateDiscussionsPage","addPrivateDiscussionSessionDropdown","notificationComponents","byobuPrivateDiscussionCreated","byobuPrivateDiscussionReplied","PrivateDiscussionRepliedNotification","NotificationGrid"],"mappings":"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","file":"forum.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 46);\n","module.exports = flarum.core.compat['extend'];","module.exports = flarum.core.compat['utils/ItemList'];","module.exports = flarum.core.compat['components/Button'];","module.exports = flarum.core.compat['models/User'];","module.exports = flarum.core.compat['models/Discussion'];","module.exports = flarum.core.compat['Model'];","module.exports = flarum.core.compat['models/Group'];","module.exports = flarum.core.compat['helpers/listItems'];","module.exports = flarum.core.compat['components/DiscussionPage'];","module.exports = flarum.core.compat['components/LinkButton'];","module.exports = flarum.core.compat['helpers/highlight'];","module.exports = flarum.core.compat['helpers/username'];","module.exports = flarum.core.compat['utils/extract'];","module.exports = flarum.core.compat['components/DiscussionList'];","module.exports = flarum.core.compat['components/UserPage'];","module.exports = flarum.core.compat['components/LogInModal'];","module.exports = flarum.core.compat['components/Notification'];","module.exports = flarum.core.compat['utils/classList'];","export default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  subClass.__proto__ = superClass;\n}","import highlight from 'flarum/helpers/highlight';\r\nimport avatar from 'flarum/helpers/avatar';\r\nimport username from 'flarum/helpers/username';\r\n\r\nexport default class UserSearchSource {\r\n    view(query) {\r\n        if (query.length < 3 || this.loading) return;\r\n\r\n        if (!app.cache.byobuResults) {\r\n            app.cache.byobuResults = [];\r\n        }\r\n\r\n        this.query = query;\r\n\r\n        if (!app.cache.byobuResults[this.query]) {\r\n\r\n            this.loading = true;\r\n\r\n            app.cache.byobuResults[this.query] = [];\r\n            app.store.find('users', {\r\n                filter: {q: this.query + ' allows-pd'},\r\n                page: {limit: 5}\r\n            }).then(this.pushResults.bind(this));\r\n        } else\r\n\r\n            return [\r\n                <li className=\"Dropdown-header\">{app.translator.trans('core.forum.search.users_heading')}</li>,\r\n                app.cache.byobuResults[this.query].map(user => {\r\n                    const name = username(user);\r\n                    name.children[0] = highlight(name.children[0], this.query);\r\n\r\n                    return (\r\n                        <li className='SearchResult' data-index={'users:' + user.id()}>\r\n                            <a data-index={'users:' + user.id()}>\r\n                                {avatar(user)}\r\n                                {name}\r\n                            </a>\r\n                        </li>\r\n                    );\r\n                })\r\n            ];\r\n    }\r\n\r\n    pushResults(results) {\r\n        results.payload.data.map(result => {\r\n            var user = app.store.getById('users', result.id);\r\n            app.cache.byobuResults[this.query].push(user);\r\n        });\r\n        this.loading = false;\r\n        m.redraw();\r\n    }\r\n}\r\n","import highlight from 'flarum/helpers/highlight';\r\n\r\nexport default class GroupSearchSource {\r\n    search(query) {\r\n        return app.store.find('groups', {\r\n            filter: {q: query},\r\n            page: {limit: 5}\r\n        });\r\n    }\r\n\r\n    view(query) {\r\n        query = query.toLowerCase();\r\n\r\n        const results = app.store.all('groups')\r\n            .filter(group => group.namePlural().toLowerCase().substr(0, query.length) === query);\r\n\r\n        if (!results.length) return '';\r\n\r\n        return [\r\n            <li className=\"Dropdown-header\">{app.translator.trans('fof-byobu.forum.search.headings.groups')}</li>,\r\n            results.map(group => {\r\n                const groupName = group.namePlural();\r\n                var name = highlight(groupName, query);\r\n\r\n                return (\r\n                    <li className=\"SearchResult\" data-index={'groups:' + group.id()}>\r\n                        <a data-index={'groups:' + group.id()}>\r\n                            <span class=\"groupName\">{name}</span>\r\n                        </a>\r\n                    </li>\r\n                );\r\n            })\r\n        ];\r\n    }\r\n}\r\n","import extract from 'flarum/utils/extract';\r\nimport username from 'flarum/helpers/username';\r\nimport User from 'flarum/models/User';\r\nimport Group from 'flarum/models/Group';\r\n\r\nexport default function recipientLabel(recipient, attrs = {}) {\r\n  attrs.style = attrs.style || {};\r\n  attrs.className = 'RecipientLabel ' + (attrs.className || '');\r\n\r\n  const link = extract(attrs, 'link');\r\n\r\n  var label;\r\n\r\n  if (recipient instanceof User) {\r\n      label = username(recipient);\r\n\r\n      if (link) {\r\n          attrs.title = recipient.username() || '';\r\n          attrs.href = app.route.user(recipient);\r\n          attrs.config = m.route;\r\n      }\r\n  } else if (recipient instanceof Group) {\r\n      label = recipient.namePlural();\r\n  } else {\r\n      attrs.className += ' none';\r\n      label = app.translator.trans('fof-byobu.forum.labels.user_deleted');\r\n  }\r\n\r\n  return (\r\n    m((link ? 'a' : 'span'), attrs,\r\n        <span className=\"RecipientLabel-text\">\r\n            {label}\r\n        </span>\r\n    )\r\n  );\r\n}\r\n","import Search from \"flarum/components/Search\";\r\nimport UserSearchSource from \"./sources/UserSearchSource\";\r\nimport GroupSearchSource from \"./sources/GroupSearchSource\";\r\nimport ItemList from \"flarum/utils/ItemList\";\r\nimport classList from \"flarum/utils/classList\";\r\nimport extractText from \"flarum/utils/extractText\";\r\nimport LoadingIndicator from \"flarum/components/LoadingIndicator\";\r\nimport recipientLabel from \"../../common/helpers/recipientLabel\";\r\nimport User from \"flarum/models/User\";\r\nimport Group from \"flarum/models/Group\";\r\n\r\nexport default class RecipientSearch extends Search {\r\n\r\n    config(isInitialized) {\r\n        if (isInitialized) return;\r\n\r\n        const $search = this;\r\n\r\n        this.$('.Search-results').on('click', (e) => {\r\n            const target = this.$('.SearchResult.active')\r\n\r\n            $search.addRecipient(target.data('index'));\r\n            $search.$('.RecipientsInput').focus();\r\n        });\r\n\r\n        this.$('.Search-results').on('touchstart', (e) => {\r\n            const target = this.$(e.target.parentNode);\r\n\r\n            $search.addRecipient(target.data('index'));\r\n            $search.$('.RecipientsInput').focus();\r\n        });\r\n\r\n        $('.RecipientsInput').on('keyup', () => {\r\n            clearTimeout(this.typingTimer);\r\n            this.doSearch = false;\r\n            this.typingTimer = setTimeout(() => {\r\n                this.doSearch = true;\r\n                m.redraw();\r\n            }, 900);\r\n        }).on('keydown', () => {\r\n            clearTimeout(this.typingTimer);\r\n        });\r\n\r\n        super.config(isInitialized);\r\n    }\r\n\r\n    view() {\r\n        if (typeof this.value() === 'undefined') {\r\n            this.value('');\r\n        }\r\n\r\n        const loading = this.value() && this.value().length >= 3;\r\n\r\n        if (!this.sources) {\r\n            this.sources = this.sourceItems().toArray();\r\n        }\r\n\r\n        return m('div', {\r\n            className: 'AddRecipientModal-form-input'\r\n        }, [\r\n            m('div', {\r\n                className: 'RecipientsInput-selected RecipientsLabel'\r\n            }, this.props.selected().toArray().map(recipient =>\r\n                recipientLabel(recipient, {\r\n                    onclick: () => {\r\n                        this.removeRecipient(recipient);\r\n                    }\r\n                })\r\n            )),\r\n            m('input', {\r\n                className: 'RecipientsInput FormControl ' + classList({\r\n                    open: !!this.value(),\r\n                    focused: !!this.value(),\r\n                    active: !!this.value(),\r\n                    loading: !!this.loadingSources\r\n                }),\r\n                config: function (element) {\r\n                    element.focus();\r\n                },\r\n                type: 'search',\r\n                placeholder: extractText(app.translator.trans('fof-byobu.forum.input.search_recipients')),\r\n                value: this.value(),\r\n                oninput: m.withAttr('value', this.value),\r\n                onfocus: () => this.hasFocus = true,\r\n                onblur: () => this.hasFocus = false\r\n            }),\r\n            m('ul', {\r\n                className: 'Dropdown-menu Search-results fade ' + classList({\r\n                    in: !!loading\r\n                })\r\n            }, !this.doSearch\r\n                ? LoadingIndicator.component({size: 'tiny', className: 'Button Button--icon Button--link'})\r\n                : this.sources.map(source => source.view(this.value()))\r\n            )\r\n        ]);\r\n    }\r\n\r\n    /**\r\n     * Build an item list of SearchSources.\r\n     *\r\n     * @return {ItemList}\r\n     */\r\n    sourceItems() {\r\n        const items = new ItemList();\r\n\r\n        // Add user source based on permissions.\r\n        if (\r\n            (!this.props.discussion && app.forum.attribute('canStartPrivateDiscussionWithUsers')) ||\r\n            (this.props.discussion && this.props.discussion.canEditUserRecipients())\r\n        ) {\r\n            items.add('users', new UserSearchSource());\r\n        }\r\n\r\n        // Add group source based on permissions.\r\n        if (\r\n            (!this.props.discussion && app.forum.attribute('canStartPrivateDiscussionWithGroups')) ||\r\n            (this.props.discussion && this.props.discussion.canEditGroupRecipients())\r\n        ) {\r\n            items.add('groups', new GroupSearchSource());\r\n        }\r\n\r\n        return items;\r\n    }\r\n\r\n\r\n    /**\r\n     * Clear the search input and the current controller's active search.\r\n     */\r\n    clear() {\r\n        this.value('');\r\n\r\n        m.redraw();\r\n    }\r\n\r\n    /**\r\n     * Adds a recipient.\r\n     *\r\n     * @param value\r\n     */\r\n    addRecipient(value) {\r\n\r\n        let values = value.split(':'),\r\n            type = values[0],\r\n            id = values[1];\r\n\r\n        let recipient = this.findRecipient(type, id);\r\n\r\n        this.props.selected().add(value, recipient);\r\n\r\n        this.clear();\r\n    }\r\n\r\n    /**\r\n     * Removes a recipient.\r\n     *\r\n     * @param recipient\r\n     */\r\n    removeRecipient(recipient) {\r\n        let type;\r\n\r\n        if (recipient instanceof User) {\r\n            type = 'users';\r\n        }\r\n        if (recipient instanceof Group) {\r\n            type = 'groups';\r\n        }\r\n\r\n        this.props.selected().remove(type + \":\" + recipient.id());\r\n\r\n        m.redraw();\r\n    }\r\n\r\n    /**\r\n     * Loads a recipient from the global store.\r\n     *\r\n     * @param store\r\n     * @param id\r\n     * @returns {Model}\r\n     */\r\n    findRecipient(store, id) {\r\n        return app.store.getById(store, id);\r\n    }\r\n}\r\n","import Modal from \"flarum/components/Modal\";\r\nimport DiscussionPage from \"flarum/components/DiscussionPage\";\r\nimport Button from \"flarum/components/Button\";\r\nimport ItemList from \"flarum/utils/ItemList\";\r\nimport RecipientSearch from \"./RecipientSearch\";\r\nimport User from \"flarum/models/User\";\r\nimport Group from \"flarum/models/Group\";\r\n\r\nexport default class AddRecipientModal extends Modal {\r\n    init() {\r\n        super.init();\r\n\r\n        this.selected = m.prop(new ItemList);\r\n\r\n        if (this.props.discussion) {\r\n            // Adds recipients of the currently viewed discussion.\r\n            this.assignInitialRecipients(this.props.discussion);\r\n        } else if (this.props.selectedRecipients.toArray().length > 0) {\r\n            // Adds previously selected recipients.\r\n            this.selected().merge(this.props.selectedRecipients);\r\n        } else {\r\n            // Adds the current user in case there are no selected recipients yet and this is a new discussion.\r\n            this.selected().add(\"users:\" + app.session.user.id(), app.session.user);\r\n        }\r\n\r\n        this.recipientSearch = RecipientSearch.component({\r\n            selected: this.selected,\r\n            discussion: this.props.discussion\r\n        });\r\n    }\r\n\r\n    isDismissible() {\r\n        return false;\r\n    }\r\n\r\n    assignInitialRecipients(discussion) {\r\n        discussion.recipientUsers().map(user => {\r\n            this.selected().add(\"users:\" + user.id(), user);\r\n        });\r\n        discussion.recipientGroups().map(group => {\r\n            this.selected().add(\"groups:\" + group.id(), group);\r\n        });\r\n    }\r\n\r\n    className() {\r\n        return 'AddRecipientModal';\r\n    }\r\n\r\n    title() {\r\n        return this.props.discussion\r\n            ? app.translator.trans('fof-byobu.forum.modal.titles.update_recipients', {title: <em>{this.props.discussion.title()}</em>})\r\n            : app.translator.trans('fof-byobu.forum.modal.titles.add_recipients');\r\n    }\r\n\r\n    helpText() {\r\n        return this.props.discussion\r\n            ? app.translator.trans('fof-byobu.forum.modal.help.update_recipients')\r\n            : app.translator.trans('fof-byobu.forum.modal.help.add_recipients');\r\n    }\r\n\r\n    content() {\r\n        const isDisabled = this.selected().toArray().length < 2;\r\n\r\n        return [\r\n            <div className=\"Modal-body\">\r\n                <div class=\"AddRecipientModal-help\">\r\n                    {this.helpText()}\r\n                </div>\r\n                <div className=\"AddRecipientModal-form\">\r\n                    {this.recipientSearch}\r\n                    <div className=\"AddRecipientModal-form-submit App-primaryControl\">\r\n                        {Button.component({\r\n                            type: 'submit',\r\n                            className: 'Button Button--primary',\r\n                            disabled: isDisabled,\r\n                            icon: 'fas fa-check',\r\n                            children: app.translator.trans('fof-byobu.forum.buttons.submit')\r\n                        })}\r\n                        {Button.component({\r\n                            onclick: this.hide.bind(this),\r\n                            className: 'Button Button--cancel',\r\n                            children: app.translator.trans('fof-byobu.forum.buttons.cancel')\r\n                        })}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        ];\r\n    }\r\n\r\n    select(e) {\r\n        // Ctrl + Enter submits the selection, just Enter completes the current entry\r\n        if (e.metaKey || e.ctrlKey || this.selected.indexOf(this.index) !== -1) {\r\n            if (this.selected().length) {\r\n                this.$('form').submit();\r\n            }\r\n        }\r\n    }\r\n\r\n    onsubmit(e) {\r\n        e.preventDefault();\r\n\r\n        const discussion = this.props.discussion;\r\n        const recipients = this.selected();\r\n\r\n        let recipientGroups = [];\r\n        let recipientUsers = [];\r\n\r\n        recipients.toArray().forEach(recipient => {\r\n            if (recipient instanceof User) {\r\n                recipientUsers.push(recipient);\r\n            }\r\n            if (recipient instanceof Group) {\r\n                recipientGroups.push(recipient);\r\n            }\r\n        });\r\n\r\n        // Recipients are updated here for existing discussions here.\r\n        if (discussion) {\r\n            discussion.save({relationships: {recipientUsers, recipientGroups}})\r\n                .then(() => {\r\n                    if (app.current instanceof DiscussionPage) {\r\n                        app.current.stream.update();\r\n                    }\r\n                    m.redraw();\r\n                });\r\n        }\r\n\r\n        // Use the onsubmit callback to trigger an update in the DiscussionComposer\r\n        if (this.props.onsubmit) this.props.onsubmit(recipients);\r\n\r\n        app.modal.close();\r\n\r\n        app.composer.show();\r\n        m.redraw.strategy('none');\r\n    }\r\n}\r\n","import DiscussionComposer from \"flarum/components/DiscussionComposer\";\r\nimport AddRecipientModal from \"./AddRecipientModal\";\r\n\r\nexport default class PrivateDiscussionComposer extends DiscussionComposer {\r\n    init() {\r\n        super.init();\r\n        this.chooseRecipients();\r\n\r\n        const username = m.route.param('username');\r\n\r\n        if (typeof username !== 'undefined') {\r\n            this.addDefaultRecipients(username);\r\n        }\r\n    }\r\n\r\n    onsubmit() {\r\n        this.loading = true;\r\n\r\n        const recipients = this.recipients.toArray();\r\n\r\n        if (recipients.length < 2) {\r\n            app.modal.show(new AddRecipientModal({\r\n                selectedRecipients: this.recipients\r\n            }))\r\n\r\n            this.loading = false;\r\n        } else {\r\n            const data = this.data();\r\n\r\n            app.store.createRecord('discussions').save(data).then(\r\n                discussion => {\r\n                    app.composer.hide();\r\n                    if (app.cache.discussionList) {\r\n                        app.cache.discussionList.addDiscussion(discussion);\r\n                    }\r\n                    m.route(app.route.discussion(discussion));\r\n                },\r\n                this.loaded.bind(this)\r\n            );\r\n        }\r\n    }\r\n}","export default function recipientCountLabel(count, attrs = {}) {\r\n  attrs.style = attrs.style || {};\r\n  attrs.className = 'RecipientLabel ' + (attrs.className || '');\r\n\r\n  var label = app.translator.transChoice('fof-byobu.forum.labels.recipients', count, {count});\r\n\r\n  return (\r\n    m('span', attrs,\r\n        <span className=\"RecipientLabel-text\">\r\n            {label}\r\n        </span>\r\n    )\r\n  );\r\n}\r\n","import { extend, override } from \"flarum/extend\";\r\nimport PrivateDiscussionComposer from \"./components/PrivateDiscussionComposer\";\r\nimport AddRecipientModal from \"./components/AddRecipientModal\";\r\nimport recipientCountLabel from \"../common/helpers/recipientCountLabel\";\r\nimport User from \"flarum/models/User\";\r\nimport Group from \"flarum/models/Group\";\r\nimport ItemList from \"flarum/utils/ItemList\";\r\n\r\nexport default function (app) {\r\n    // Add recipient-selection abilities to the discussion composer.\r\n    PrivateDiscussionComposer.prototype.recipients = new ItemList;\r\n    PrivateDiscussionComposer.prototype.recipientUsers = [];\r\n    PrivateDiscussionComposer.prototype.recipientGroups = [];\r\n\r\n    // Add the session user as a recipient\r\n    // If the composer is triggered from a different user page, add them as a recipient\r\n    PrivateDiscussionComposer.prototype.addDefaultRecipients = function (username) {\r\n        const user = app.store.getBy('users', 'username', username);\r\n\r\n        this.recipients.add('users:' + app.session.user.id(), app.session.user);\r\n        if(user.id() !== app.session.user.id()) {\r\n            this.recipients.add('users:' + user.id(), user);\r\n        }\r\n    };\r\n\r\n    // Add a recipient selection modal when clicking the recipient tag label.\r\n    PrivateDiscussionComposer.prototype.chooseRecipients = function () {\r\n        //const actorRecipientClassName = '.RecipientsInput-selected > .RecipientLabel:first-child';\r\n        app.modal.show(\r\n            new AddRecipientModal({\r\n                selectedRecipients: this.recipients,\r\n                onsubmit: (recipients) => {\r\n                    this.recipients = recipients;\r\n\r\n                    // Focus on recipient autocomplete field.\r\n                    this.$('.RecipientsInput').focus();\r\n                }\r\n            })\r\n        )\r\n        //$(actorRecipientClassName).css('display', 'none');\r\n    };\r\n\r\n    // Add a tag-selection menu to the discussion composer's header, after the\r\n    // title.\r\n    extend(PrivateDiscussionComposer.prototype, 'headerItems', function (items) {\r\n        if (app.session.user && app.forum.attribute('canStartPrivateDiscussion')) {\r\n            const recipients = this.recipients.toArray();\r\n\r\n            items.add('recipients', (\r\n                <a className=\"PrivateDiscussionComposer-changeRecipients\"\r\n                    onclick={this.chooseRecipients.bind(this)}>\r\n                    {recipients.length\r\n                        ? recipientCountLabel(recipients.length)\r\n                        : <span className=\"RecipientLabel none\">{app.translator.trans('fof-byobu.forum.buttons.add_recipients')}</span>}\r\n                </a>\r\n            ), 5);\r\n        }\r\n    });\r\n\r\n    // Add the selected tags as data to submit to the server.\r\n    extend(PrivateDiscussionComposer.prototype, 'data', function (data) {\r\n        const users = [];\r\n        const groups = [];\r\n        this.recipients.toArray().forEach(recipient => {\r\n\r\n            if (recipient instanceof User) {\r\n                users.push(recipient);\r\n            }\r\n\r\n            if (recipient instanceof Group) {\r\n                groups.push(recipient);\r\n            }\r\n        });\r\n\r\n        data.relationships = data.relationships || {};\r\n\r\n        if (users.length) {\r\n            data.relationships.recipientUsers = users;\r\n        }\r\n\r\n        if (groups.length) {\r\n            data.relationships.recipientGroups = groups;\r\n        }\r\n    });\r\n}\r\n","import extract from 'flarum/utils/extract';\r\nimport recipientLabel from './recipientLabel';\r\n\r\nexport default function recipientsLabel(recipients, attrs = {}) {\r\n  const children = [];\r\n  const link = extract(attrs, 'link');\r\n\r\n  attrs.className = 'RecipientsLabel ' + (attrs.className || '');\r\n\r\n  if (recipients) {\r\n      recipients.forEach(recipient => {\r\n          children.push(recipientLabel(recipient, {link}));\r\n      });\r\n  } else {\r\n    children.push(recipientLabel());\r\n  }\r\n\r\n  return <span {...attrs}>{children}</span>;\r\n}\r\n","import {extend} from \"flarum/extend\";\r\nimport DiscussionListItem from \"flarum/components/DiscussionListItem\";\r\nimport DiscussionPage from \"flarum/components/DiscussionPage\";\r\nimport DiscussionHero from \"flarum/components/DiscussionHero\";\r\nimport DiscussionList from \"flarum/components/DiscussionList\";\r\nimport recipientsLabel from \"../common/helpers/recipientsLabel\";\r\n\r\nexport default function() {\r\n\r\n    const addToDiscussion = function(discussion, items, long) {\r\n        let recipients = [];\r\n\r\n        if (discussion.recipientUsers().length) {\r\n            recipients = recipients.concat(discussion.recipientUsers());\r\n        }\r\n\r\n        if (discussion.recipientGroups().length) {\r\n            recipients = recipients.concat(discussion.recipientGroups());\r\n        }\r\n\r\n        if (recipients && recipients.length) {\r\n            if (long) {\r\n                items.add('recipients', recipientsLabel(recipients), 10);\r\n            } else {\r\n                items.add('recipients', recipientsLabel(recipients, {link: true}), 4);\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Adds User labels on the discussion index page.\r\n     */\r\n    extend(DiscussionListItem.prototype, 'infoItems', function(items) {\r\n        const discussion = this.props.discussion;\r\n\r\n        addToDiscussion(discussion, items, true);\r\n    });\r\n\r\n    /**\r\n     * Require recipients from the API whenever we're loading a Discussion page.\r\n     */\r\n    extend(DiscussionPage.prototype, 'params', function(params) {\r\n        params.include.push('recipientUsers');\r\n        params.include.push('recipientGroups');\r\n    });\r\n    extend(DiscussionList.prototype, 'requestParams', function(params) {\r\n        params.include.push('recipientUsers');\r\n        params.include.push('recipientGroups');\r\n    });\r\n\r\n\r\n    /**\r\n     * Adds User labels on the discussion Hero.\r\n     */\r\n    extend(DiscussionHero.prototype, 'items', function(items) {\r\n        const discussion = this.props.discussion;\r\n\r\n        addToDiscussion(discussion, items, false);\r\n    });\r\n}\r\n","import { extend } from 'flarum/extend';\r\nimport DiscussionControls from 'flarum/utils/DiscussionControls';\r\nimport Button from 'flarum/components/Button';\r\n\r\nimport AddRecipientModal from './components/AddRecipientModal';\r\n\r\nexport default function() {\r\n    // Add a control allowing the discussion to be moved to another category.\r\n    extend(DiscussionControls, 'moderationControls', function(items, discussion) {\r\n        if (discussion.canEditRecipients()) {\r\n            items.add('recipients', Button.component({\r\n                children: app.translator.trans('fof-byobu.forum.buttons.edit_recipients'),\r\n                icon: 'far fa-map',\r\n                onclick: () => app.modal.show(new AddRecipientModal({discussion}))\r\n            }));\r\n        }\r\n    });\r\n}\r\n","import {extend} from \"flarum/extend\";\r\nimport Discussion from \"flarum/models/Discussion\";\r\nimport Badge from \"flarum/components/Badge\";\r\n\r\nexport default function addHasRecipientsBadge() {\r\n    extend(Discussion.prototype, 'badges', function (badges) {\r\n        if (this.recipientUsers().length || this.recipientGroups().length) {\r\n            badges.add('private', Badge.component({\r\n                type: 'private',\r\n                label: app.translator.trans('fof-byobu.forum.badges.is_private.tooltip'),\r\n                icon: 'fas fa-map'\r\n            }), 10);\r\n        }\r\n    });\r\n}\r\n","import {extend} from 'flarum/extend';\r\nimport UserControls from 'flarum/utils/UserControls';\r\nimport PrivateDiscussionComposer from \"./components/PrivateDiscussionComposer\";\r\nimport Button from 'flarum/components/Button';\r\nimport ItemList from 'flarum/utils/ItemList';\r\n\r\nexport default function () {\r\n    // Add a control allowing the discussion to be moved to another category.\r\n    extend(UserControls, 'userControls', function (items, user) {\r\n        if (app.session.user &&\r\n            app.session.user.id() !== user.id() &&\r\n            app.forum.attribute('canStartPrivateDiscussion') &&\r\n            (user.blocksPd() === false || app.forum.attribute('canStartPrivateDiscussionWithBlockers') && user.cannotBeDirectMessaged())\r\n        ) {\r\n            items.add('private-discussion', Button.component({\r\n                children: app.translator.trans('fof-byobu.forum.buttons.send_pd', {username: user.username()}),\r\n                icon: 'far fa-map',\r\n                onclick: () => {\r\n                    const deferred = m.deferred();\r\n\r\n                    let recipients = new ItemList();\r\n                    recipients.add('users:' + app.session.user.id(), app.session.user);\r\n                    recipients.add('users:' + user.id(), user);\r\n\r\n                    PrivateDiscussionComposer.prototype.recipients = recipients;\r\n\r\n                    const component = new PrivateDiscussionComposer({\r\n                        user: app.session.user,\r\n                        recipients: recipients,\r\n                        recipientUsers: recipients,\r\n                        titlePlaceholder: app.translator.trans('fof-byobu.forum.composer_private_discussion.title_placeholder'),\r\n                        submitLabel: app.translator.trans('fof-byobu.forum.composer_private_discussion.submit_button')\r\n                    });\r\n\r\n                    app.composer.load(component);\r\n                    app.composer.show();\r\n\r\n                    deferred.resolve(component);\r\n\r\n                    return deferred.promise;\r\n                }\r\n            }));\r\n        }\r\n\r\n        return items;\r\n    });\r\n}\r\n","import {extend} from 'flarum/extend';\r\nimport SettingsPage from 'flarum/components/SettingsPage';\r\nimport Switch from \"flarum/components/Switch\";\r\n\r\nexport default function () {\r\n    extend(SettingsPage.prototype, 'privacyItems', function (items) {\r\n        items.add('byobu-block-dm',\r\n            Switch.component({\r\n                children: app.translator.trans('fof-byobu.forum.user.settings.block_pd'),\r\n                state: this.user.preferences().blocksPd,\r\n                onchange: (value, component) => this.preferenceSaver('blocksPd')(value, component)\r\n            })\r\n        )\r\n    });\r\n}\r\n","import DiscussionList from 'flarum/components/DiscussionList';\r\n\r\nexport default class PrivateDiscussionList extends DiscussionList\r\n{\r\n}\r\n","import UserPage from 'flarum/components/UserPage';\r\nimport PrivateDiscussionList from './PrivateDiscussionList';\r\nimport Button from 'flarum/components/Button';\r\nimport Dropdown from 'flarum/components/Dropdown';\r\nimport ItemList from 'flarum/utils/ItemList';\r\nimport listItems from 'flarum/helpers/listItems';\r\nimport PrivateDiscussionComposer from './PrivateDiscussionComposer';\r\nimport LogInModal from 'flarum/components/LogInModal';\r\n\r\nexport default class PrivateDiscussionsUserPage extends UserPage {\r\n    init() {\r\n        super.init();\r\n\r\n        this.changeSort('latest');\r\n\r\n        this.duser = null;\r\n    }\r\n\r\n    show(user) {\r\n        // We can not create the list in init because the user will not be available if it has to be loaded asynchronously\r\n        this.list = new PrivateDiscussionList({\r\n            params: {\r\n                q: `byobu:${user.username()} is:private`,\r\n                sort: this.sort,\r\n            }\r\n        });\r\n\r\n        this.list.refresh();\r\n\r\n        this.duser = user;\r\n\r\n        // We call the parent method after creating the list, this way the this.list property\r\n        // is set before content() is called for the first time\r\n        super.show(user);\r\n    }\r\n\r\n    handleChangeSort(sort, e) {\r\n        e.preventDefault();\r\n\r\n        this.changeSort(sort);\r\n    }\r\n\r\n    changeSort(sort) {\r\n        this.sort = sort;\r\n        this.loadUser(m.route.param('username'));\r\n    }\r\n\r\n    newDiscussionAction(e) {\r\n        e.preventDefault();\r\n\r\n        const deferred = m.deferred();\r\n\r\n        if (app.session.user) {\r\n            let recipients = new ItemList();\r\n            recipients.add('users:' + app.session.user.id(), app.session.user);\r\n\r\n            if (this.duser !== null && app.session.user !== this.duser) {\r\n                recipients.add('users:' + this.duser.id(), this.duser);\r\n            }\r\n\r\n            PrivateDiscussionComposer.prototype.recipients = recipients;\r\n\r\n            const component = new PrivateDiscussionComposer({\r\n                user: app.session.user,\r\n                recipients: recipients,\r\n                recipientUsers: recipients,\r\n                titlePlaceholder: app.translator.trans('fof-byobu.forum.composer_private_discussion.title_placeholder'),\r\n                submitLabel: app.translator.trans('fof-byobu.forum.composer_private_discussion.submit_button')\r\n            });\r\n\r\n            app.composer.load(component);\r\n\r\n            deferred.resolve(component);\r\n        } else {\r\n            deferred.reject();\r\n\r\n            app.modal.show(new LogInModal());\r\n        }\r\n\r\n        return deferred.promise;\r\n    }\r\n\r\n    content() {\r\n        return (\r\n            <div className=\"DiscussionsUserPage\">\r\n                <div className=\"DiscussionsUserPage-toolbar\">\r\n                    <ul className=\"DiscussionsUserPage-toolbar-action\">{listItems(this.actionItems().toArray())}</ul>\r\n                    <ul className=\"DiscussionsUserPage-toolbar-view\">{listItems(this.viewItems().toArray())}</ul>\r\n                </div>\r\n                {this.list.render()}\r\n            </div>\r\n        );\r\n    }\r\n\r\n    actionItems() {\r\n        const items = new ItemList();\r\n        const canStartDiscussion = app.forum.attribute('canStartDiscussion') || !app.session.user;\r\n\r\n        items.add('start_private',\r\n            Button.component({\r\n                children: app.translator.trans(canStartDiscussion ? 'fof-byobu.forum.nav.start_button' : 'core.forum.index.cannot_start_discussion_button'),\r\n                className: 'Button Button--primary IndexPage-newDiscussion',\r\n                itemClassName: 'App-primaryControl',\r\n                onclick: this.newDiscussionAction.bind(this),\r\n                disabled: !canStartDiscussion\r\n            }));\r\n\r\n        return items;\r\n    }\r\n\r\n    viewItems() {\r\n        const items = new ItemList();\r\n        const sortMap = this.list.sortMap();\r\n\r\n        const sortOptions = {};\r\n        for (const i in sortMap) {\r\n            sortOptions[i] = app.translator.trans('core.forum.index_sort.' + i + '_button');\r\n        }\r\n\r\n        items.add('sort',\r\n            Dropdown.component({\r\n                buttonClassName: 'Button',\r\n                label: sortOptions[this.sort] || Object.keys(sortMap).map(key => sortOptions[key])[0],\r\n                children: Object.keys(sortOptions).map(value => {\r\n                    const label = sortOptions[value];\r\n                    const active = (this.sort || Object.keys(sortMap)[0]) === value;\r\n\r\n                    return Button.component({\r\n                        children: label,\r\n                        icon: active ? 'fas fa-check' : true,\r\n                        onclick: this.handleChangeSort.bind(this, value),\r\n                        active: active,\r\n                    })\r\n                }),\r\n            })\r\n        );\r\n\r\n        return items;\r\n    }\r\n}\r\n","import {extend} from 'flarum/extend';\r\nimport UserPage from 'flarum/components/UserPage';\r\nimport LinkButton from 'flarum/components/LinkButton';\r\n\r\nimport PrivateDiscussionsUserPage from \"./components/PrivateDiscussionsUserPage\";\r\n\r\nexport default function () {\r\n    if (!Number(app.data['fof-byobu.enable_byobu_user_page'])) return;\r\n\r\n    app.routes['user.byobu'] = {path: '/u/:username/byobu', component: PrivateDiscussionsUserPage.component()};\r\n\r\n    extend(UserPage.prototype, 'navItems', function (items) {\r\n        const href = app.route('user.byobu', {username: this.user.username()});\r\n\r\n        // Hide links from guests if they are not already on the page\r\n        if (!app.session.user && m.route() !== href) return;\r\n\r\n        items.add('byobu',\r\n            LinkButton.component({\r\n                href,\r\n                children: app.translator.trans('fof-byobu.forum.user.byobu_link'),\r\n                icon: 'fas fa-map'\r\n            }),\r\n            85\r\n        );\r\n    })\r\n}\r\n","import Notification from 'flarum/components/Notification';\r\n\r\nexport default class PrivateDiscussionNotification extends Notification {\r\n  icon() {\r\n    return 'fas fa-map';\r\n  }\r\n\r\n  href() {\r\n    const notification = this.props.notification;\r\n    const discussion = notification.subject();\r\n\r\n    return app.route.discussion(discussion);\r\n  }\r\n\r\n  content() {\r\n    const user = this.props.notification.fromUser();\r\n    return app.translator.trans('fof-byobu.forum.notifications.pd_text', {\r\n      user: user,\r\n    });\r\n  }\r\n}","import Notification from 'flarum/components/Notification';\r\n\r\nexport default class PrivateDiscussionReplyNotification extends Notification {\r\n  icon() {\r\n    return 'fas fa-reply';\r\n  }\r\n\r\n  href() {\r\n    const notification = this.props.notification;\r\n    const discussion = notification.subject();\r\n    const content = notification.content() || {};\r\n\r\n    return app.route.discussion(discussion, content.postNumber);\r\n  }\r\n\r\n  content() {\r\n    const user = this.props.notification.fromUser();\r\n    return app.translator.trans('fof-byobu.forum.notifications.pd_reply_text', {\r\n      user: user,\r\n    });\r\n  }\r\n}\r\n","import { extend } from 'flarum/extend';\r\nimport Page from 'flarum/components/Page';\r\nimport ItemList from 'flarum/utils/ItemList';\r\nimport listItems from 'flarum/helpers/listItems';\r\nimport icon from 'flarum/helpers/icon';\r\nimport PrivateDiscussionList from './PrivateDiscussionList';\r\nimport WelcomeHero from 'flarum/components/WelcomeHero';\r\nimport PrivateDiscussionComposer from './PrivateDiscussionComposer';\r\nimport LogInModal from 'flarum/components/LogInModal';\r\nimport DiscussionPage from 'flarum/components/DiscussionPage';\r\nimport Select from 'flarum/components/Select';\r\nimport Button from 'flarum/components/Button';\r\nimport LinkButton from 'flarum/components/LinkButton';\r\nimport SelectDropdown from 'flarum/components/SelectDropdown';\r\n\r\nexport default class PrivateDiscussionIndex extends Page\r\n{\r\n    init() {\r\n        super.init();\r\n\r\n        // If the user is returning from a discussion page, then take note of which\r\n        // discussion they have just visited. After the view is rendered, we will\r\n        // scroll down so that this discussion is in view.\r\n        if (app.previous instanceof DiscussionPage) {\r\n            this.lastDiscussion = app.previous.discussion;\r\n        }\r\n\r\n        // If the user is coming from the discussion list, then they have either\r\n        // just switched one of the parameters (filter, sort, search) or they\r\n        // probably want to refresh the results. We will clear the discussion list\r\n        // cache so that results are reloaded.\r\n        if (app.previous instanceof PrivateDiscussionIndex) {\r\n            app.cache.privateDiscussionList = null;\r\n        }\r\n\r\n        const params = this.params();\r\n\r\n        if (app.cache.privateDiscussionList) {\r\n            // Compare the requested parameters (sort, search query) to the ones that\r\n            // are currently present in the cached discussion list. If they differ, we\r\n            // will clear the cache and set up a new discussion list component with\r\n            // the new parameters.\r\n            Object.keys(params).some(key => {\r\n                if (app.cache.privateDiscussionList.props.params[key] !== params[key]) {\r\n                    app.cache.privateDiscussionList = null;\r\n                    return true;\r\n                }\r\n            });\r\n        }\r\n\r\n        if (!app.cache.privateDiscussionList) {\r\n            app.cache.privateDiscussionList = new PrivateDiscussionList({params});\r\n        }\r\n\r\n        app.history.push('private-index', icon('far fa-map'));\r\n\r\n        this.bodyClass = 'App--index';\r\n    }\r\n\r\n    onunload() {\r\n        // Save the scroll position so we can restore it when we return to the\r\n        // discussion list.\r\n        app.cache.scrollTop = $(window).scrollTop();\r\n    }\r\n\r\n    view() {\r\n        return (\r\n            <div className=\"IndexPage\">\r\n                {this.hero()}\r\n                <div className=\"container\">\r\n                    <nav className=\"IndexPage-nav sideNav\">\r\n                        <ul>{listItems(this.sidebarItems().toArray())}</ul>\r\n                    </nav>\r\n                    <div className=\"IndexPage-results sideNavOffset\">\r\n                        <div className=\"IndexPage-toolbar\">\r\n                            <ul className=\"IndexPage-toolbar-view\">{listItems(this.viewItems().toArray())}</ul>\r\n                            <ul className=\"IndexPage-toolbar-action\">{listItems(this.actionItems().toArray())}</ul>\r\n                        </div>\r\n                        {app.cache.discussionList.render()}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    config(isInitialized, context) {\r\n        super.config(...arguments);\r\n\r\n        if (isInitialized) return;\r\n\r\n        extend(context, 'onunload', () => $('#app').css('min-height', ''));\r\n\r\n        app.setTitle('');\r\n        app.setTitleCount(0);\r\n\r\n        // Work out the difference between the height of this hero and that of the\r\n        // previous hero. Maintain the same scroll position relative to the bottom\r\n        // of the hero so that the sidebar doesn't jump around.\r\n        const oldHeroHeight = app.cache.heroHeight;\r\n        const heroHeight = app.cache.heroHeight = this.$('.Hero').outerHeight();\r\n        const scrollTop = app.cache.scrollTop;\r\n\r\n        $('#app').css('min-height', $(window).height() + heroHeight);\r\n\r\n        // Scroll to the remembered position. We do this after a short delay so that\r\n        // it happens after the browser has done its own \"back button\" scrolling,\r\n        // which isn't right. https://github.com/flarum/core/issues/835\r\n        const scroll = () => $(window).scrollTop(scrollTop - oldHeroHeight + heroHeight);\r\n        scroll();\r\n        setTimeout(scroll, 1);\r\n\r\n        // If we've just returned from a discussion page, then the constructor will\r\n        // have set the `lastDiscussion` property. If this is the case, we want to\r\n        // scroll down to that discussion so that it's in view.\r\n        if (this.lastDiscussion) {\r\n            const $discussion = this.$(`.DiscussionListItem[data-id=\"${this.lastDiscussion.id()}\"]`);\r\n\r\n            if ($discussion.length) {\r\n                const indexTop = $('#header').outerHeight();\r\n                const indexBottom = $(window).height();\r\n                const discussionTop = $discussion.offset().top;\r\n                const discussionBottom = discussionTop + $discussion.outerHeight();\r\n\r\n                if (discussionTop < scrollTop + indexTop || discussionBottom > scrollTop + indexBottom) {\r\n                    $(window).scrollTop(discussionTop - indexTop);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get the component to display as the hero.\r\n     *\r\n     * @return {MithrilComponent}\r\n     */\r\n    hero() {\r\n        return WelcomeHero.component();\r\n    }\r\n\r\n    /**\r\n     * Build an item list for the sidebar of the index page. By default this is a\r\n     * \"New Discussion\" button, and then a DropdownSelect component containing a\r\n     * list of navigation items.\r\n     *\r\n     * @return {ItemList}\r\n     */\r\n    sidebarItems() {\r\n        const items = new ItemList();\r\n        const canStartDiscussion = app.forum.attribute('canStartDiscussion') || !app.session.user;\r\n\r\n        items.add('newDiscussion',\r\n            Button.component({\r\n                children: app.translator.trans(canStartDiscussion ? 'core.forum.index.start_discussion_button' : 'core.forum.index.cannot_start_discussion_button'),\r\n                icon: 'fas fa-edit',\r\n                className: 'Button Button--primary IndexPage-newDiscussion',\r\n                itemClassName: 'App-primaryControl',\r\n                onclick: this.newDiscussion.bind(this),\r\n                disabled: !canStartDiscussion\r\n            })\r\n        );\r\n\r\n        items.add('nav',\r\n            SelectDropdown.component({\r\n                children: this.navItems(this).toArray(),\r\n                buttonClassName: 'Button',\r\n                className: 'App-titleControl'\r\n            })\r\n        );\r\n\r\n        return items;\r\n    }\r\n\r\n    /**\r\n     * Build an item list for the navigation in the sidebar of the index page. By\r\n     * default this is just the 'All Discussions' link.\r\n     *\r\n     * @return {ItemList}\r\n     */\r\n    navItems() {\r\n        const items = new ItemList();\r\n        const params = this.stickyParams();\r\n\r\n        items.add('allDiscussions',\r\n            LinkButton.component({\r\n                href: app.route('index', params),\r\n                children: app.translator.trans('core.forum.index.all_discussions_link'),\r\n                icon: 'far fa-comments'\r\n            }),\r\n            100\r\n        );\r\n\r\n        return items;\r\n    }\r\n\r\n    /**\r\n     * Build an item list for the part of the toolbar which is concerned with how\r\n     * the results are displayed. By default this is just a select box to change\r\n     * the way discussions are sorted.\r\n     *\r\n     * @return {ItemList}\r\n     */\r\n    viewItems() {\r\n        const items = new ItemList();\r\n        const sortMap = app.cache.discussionList.sortMap();\r\n\r\n        const sortOptions = {};\r\n        for (const i in sortMap) {\r\n            sortOptions[i] = app.translator.trans('core.forum.index_sort.' + i + '_button');\r\n        }\r\n\r\n        items.add('sort',\r\n            Select.component({\r\n                options: sortOptions,\r\n                value: this.params().sort || Object.keys(sortMap)[0],\r\n                onchange: this.changeSort.bind(this)\r\n            })\r\n        );\r\n\r\n        return items;\r\n    }\r\n\r\n    /**\r\n     * Build an item list for the part of the toolbar which is about taking action\r\n     * on the results. By default this is just a \"mark all as read\" button.\r\n     *\r\n     * @return {ItemList}\r\n     */\r\n    actionItems() {\r\n        const items = new ItemList();\r\n\r\n        items.add('refresh',\r\n            Button.component({\r\n                title: app.translator.trans('core.forum.index.refresh_tooltip'),\r\n                icon: 'fas fa-refresh',\r\n                className: 'Button Button--icon',\r\n                onclick: () => app.cache.discussionList.refresh()\r\n            })\r\n        );\r\n\r\n        if (app.session.user) {\r\n            items.add('markAllAsRead',\r\n                Button.component({\r\n                    title: app.translator.trans('core.forum.index.mark_all_as_read_tooltip'),\r\n                    icon: 'fas fa-check',\r\n                    className: 'Button Button--icon',\r\n                    onclick: this.markAllAsRead.bind(this)\r\n                })\r\n            );\r\n        }\r\n\r\n        return items;\r\n    }\r\n\r\n    /**\r\n     * Return the current search query, if any. This is implemented to activate\r\n     * the search box in the header.\r\n     *\r\n     * @see Search\r\n     * @return {String}\r\n     */\r\n    searching() {\r\n        return this.params().q;\r\n    }\r\n\r\n    /**\r\n     * Redirect to the index page without a search filter. This is called when the\r\n     * 'x' is clicked in the search box in the header.\r\n     *\r\n     * @see Search\r\n     */\r\n    clearSearch() {\r\n        const params = this.params();\r\n        delete params.q;\r\n\r\n        m.route(app.route(this.props.routeName, params));\r\n    }\r\n\r\n    /**\r\n     * Redirect to the index page using the given sort parameter.\r\n     *\r\n     * @param {String} sort\r\n     */\r\n    changeSort(sort) {\r\n        const params = this.params();\r\n\r\n        if (sort === Object.keys(app.cache.discussionList.sortMap())[0]) {\r\n            delete params.sort;\r\n        } else {\r\n            params.sort = sort;\r\n        }\r\n\r\n        m.route(app.route(this.props.routeName, params));\r\n    }\r\n\r\n    /**\r\n     * Get URL parameters that stick between filter changes.\r\n     *\r\n     * @return {Object}\r\n     */\r\n    stickyParams() {\r\n        return {\r\n            sort: m.route.param('sort'),\r\n            q: m.route.param('q')\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get parameters to pass to the DiscussionList component.\r\n     *\r\n     * @return {Object}\r\n     */\r\n    params() {\r\n        const params = this.stickyParams();\r\n\r\n        params.filter = m.route.param('filter');\r\n\r\n        return params;\r\n    }\r\n\r\n    /**\r\n     * Log the user in and then open the composer for a new discussion.\r\n     *\r\n     * @return {Promise}\r\n     */\r\n    newDiscussion() {\r\n        const deferred = m.deferred();\r\n\r\n        if (app.session.user) {\r\n            this.composeNewDiscussion(deferred);\r\n        } else {\r\n            app.modal.show(\r\n                new LogInModal({\r\n                    onlogin: this.composeNewDiscussion.bind(this, deferred)\r\n                })\r\n            );\r\n        }\r\n\r\n        return deferred.promise;\r\n    }\r\n\r\n    /**\r\n     * Initialize the composer for a new discussion.\r\n     *\r\n     * @param {Deferred} deferred\r\n     * @return {Promise}\r\n     */\r\n    composeNewDiscussion(deferred) {\r\n        const component = new PrivateDiscussionComposer({user: app.session.user});\r\n\r\n        app.composer.load(component);\r\n        app.composer.show();\r\n\r\n        deferred.resolve(component);\r\n\r\n        return deferred.promise;\r\n    }\r\n\r\n    /**\r\n     * Mark all discussions as read.\r\n     *\r\n     * @return void\r\n     */\r\n    markAllAsRead() {\r\n        const confirmation = confirm(app.translator.trans('core.forum.index.mark_all_as_read_confirmation'));\r\n\r\n        if (confirmation) {\r\n            app.session.user.save({readTime: new Date()});\r\n        }\r\n    }\r\n}\r\n","import EventPost from \"flarum/components/EventPost\";\r\nimport recipientsLabel from \"../../common/helpers/recipientsLabel\";\r\n\r\nexport default class RecipientsModified extends EventPost {\r\n    static initProps(props) {\r\n        super.initProps(props);\r\n\r\n        function diff(diff1, diff2, store) {\r\n            return diff1\r\n                .filter(item => diff2.indexOf(item) === -1)\r\n                .map(id => app.store.getById(store, id));\r\n        }\r\n\r\n        const content = props.post.content();\r\n\r\n        // For event posts existing before groups functionality.\r\n        if (!content['new'] && content.length == 2) {\r\n            const oldRecipients = props.post.content()[0];\r\n            const newRecipients = props.post.content()[1];\r\n            props.added = diff(newRecipients, oldRecipients, 'users');\r\n            props.removed = diff(oldRecipients, newRecipients, 'users');\r\n        } else {\r\n            var usersAdded = diff(content['new']['users'], content['old']['users'], 'users');\r\n            var usersRemoved = diff(content['old']['users'], content['new']['users'], 'users');\r\n            var groupsAdded = diff(content['new']['groups'], content['old']['groups'], 'groups');\r\n            var groupsRemoved = diff(content['old']['groups'], content['new']['groups'], 'groups');\r\n\r\n            props.added = usersAdded.concat(groupsAdded);\r\n            props.removed = usersRemoved.concat(groupsRemoved);\r\n        }\r\n    }\r\n\r\n    icon() {\r\n        return 'far fa-map';\r\n    }\r\n\r\n    descriptionKey() {\r\n\r\n        var localeBase = 'fof-byobu.forum.post.recipients_modified.';\r\n\r\n        if (this.props.added.length) {\r\n            if (this.props.removed.length) {\r\n                return localeBase + 'added_and_removed';\r\n            }\r\n\r\n            return localeBase + 'added';\r\n        }\r\n\r\n        return localeBase + 'removed';\r\n    }\r\n\r\n    descriptionData() {\r\n        const data = {};\r\n\r\n        if (this.props.added.length) {\r\n            data.added = recipientsLabel(this.props.added, {link: true});\r\n        }\r\n\r\n        if (this.props.removed.length) {\r\n            data.removed = recipientsLabel(this.props.removed, {link: true});\r\n        }\r\n\r\n        return data;\r\n    }\r\n}\r\n","import { extend } from 'flarum/extend';\r\nimport LinkButton from 'flarum/components/LinkButton';\r\nimport SessionDropdown from 'flarum/components/SessionDropdown';\r\n\r\nexport default () => {\r\n    extend(SessionDropdown.prototype, 'items', items => {\r\n        const user = app.session.user;\r\n\r\n        items.add('privateDiscussions',\r\n            LinkButton.component({\r\n                icon: 'fas fa-map',\r\n                children: app.translator.trans('fof-byobu.forum.user.dropdown_label'),\r\n                href: app.route('user.byobu', { username: user.username() }),\r\n            }), 99\r\n        );\r\n    })\r\n}","import { extend } from 'flarum/extend';\r\nimport Model from \"flarum/Model\";\r\nimport Discussion from \"flarum/models/Discussion\";\r\nimport User from \"flarum/models/User\";\r\nimport addRecipientComposer from \"./addRecipientComposer\";\r\nimport addRecipientLabels from \"./addRecipientLabels\";\r\nimport addRecipientsControl from \"./addRecipientsControl\";\r\nimport addHasRecipientsBadge from \"./addHasRecipientsBadge\";\r\nimport addDiscussPrivatelyControl from './addDiscussPrivatelyControl';\r\nimport addPrivacySetting from './addPrivacySetting';\r\nimport addPrivateDiscussionsPage from \"./addPrivateDiscussionsPage\";\r\nimport NotificationGrid from 'flarum/components/NotificationGrid';\r\nimport PrivateDiscussionNotification from './components/PrivateDiscussionNotification';\r\nimport PrivateDiscussionRepliedNotification from './components/PrivateDiscussionReplyNotification';\r\nimport PrivateDiscussionIndex from \"./components/PrivateDiscussionIndex\";\r\nimport RecipientsModified from \"./components/RecipientsModified\";\r\nimport addPrivateDiscussionSessionDropdown from './addPrivateDiscussionsToSessionDropdown';\r\n\r\napp.initializers.add('fof-byobu', function (app) {\r\n    app.routes.private_discussions = { path: '/private-discussions', component: PrivateDiscussionIndex.component() };\r\n\r\n    Discussion.prototype.recipientUsers = Model.hasMany('recipientUsers');\r\n    Discussion.prototype.oldRecipientUsers = Model.hasMany('oldRecipientUsers');\r\n    Discussion.prototype.recipientGroups = Model.hasMany('recipientGroups');\r\n    Discussion.prototype.oldRecipientGroups = Model.hasMany('oldRecipientGroups');\r\n\r\n    Discussion.prototype.canEditRecipients = Model.attribute('canEditRecipients');\r\n    Discussion.prototype.canEditUserRecipients = Model.attribute('canEditUserRecipients');\r\n    Discussion.prototype.canEditGroupRecipients = Model.attribute('canEditGroupRecipients');\r\n    Discussion.prototype.canEditGroupRecipients = Model.attribute('canEditGroupRecipients');\r\n\r\n    User.prototype.blocksPd = Model.attribute('blocksPd');\r\n    User.prototype.cannotBeDirectMessaged = Model.attribute('cannotBeDirectMessaged');\r\n\r\n    app.postComponents.recipientsModified = RecipientsModified;\r\n\r\n    addRecipientComposer(app);\r\n    addRecipientLabels();\r\n    addRecipientsControl();\r\n    addHasRecipientsBadge();\r\n    addPrivacySetting();\r\n\r\n    addDiscussPrivatelyControl();\r\n\r\n    addPrivateDiscussionsPage();\r\n    addPrivateDiscussionSessionDropdown();\r\n\r\n    app.notificationComponents.byobuPrivateDiscussionCreated = PrivateDiscussionNotification;\r\n    app.notificationComponents.byobuPrivateDiscussionReplied = PrivateDiscussionRepliedNotification;\r\n\r\n    // Add notification preferences.\r\n    extend(NotificationGrid.prototype, 'notificationTypes', function (items) {\r\n        items.add('byobuPrivateDiscussionCreated', {\r\n            name: 'byobuPrivateDiscussionCreated',\r\n            icon: 'fas fa-map',\r\n            label: app.translator.trans('fof-byobu.forum.notifications.pd_label')\r\n        });\r\n        items.add('byobuPrivateDiscussionReplied', {\r\n            name: 'byobuPrivateDiscussionReplied',\r\n            icon: 'fas fa-map',\r\n            label: app.translator.trans('fof-byobu.forum.notifications.pd_reply_label')\r\n        });\r\n    });\r\n});\r\n","module.exports = flarum.core.compat['components/DiscussionComposer'];","module.exports = flarum.core.compat['components/Modal'];","module.exports = flarum.core.compat['components/Search'];","module.exports = flarum.core.compat['helpers/avatar'];","module.exports = flarum.core.compat['utils/extractText'];","module.exports = flarum.core.compat['components/LoadingIndicator'];","module.exports = flarum.core.compat['components/DiscussionListItem'];","module.exports = flarum.core.compat['components/DiscussionHero'];","module.exports = flarum.core.compat['utils/DiscussionControls'];","module.exports = flarum.core.compat['components/Badge'];","module.exports = flarum.core.compat['utils/UserControls'];","module.exports = flarum.core.compat['components/SettingsPage'];","module.exports = flarum.core.compat['components/Switch'];","module.exports = flarum.core.compat['components/Dropdown'];","module.exports = flarum.core.compat['components/NotificationGrid'];","module.exports = flarum.core.compat['components/Page'];","module.exports = flarum.core.compat['helpers/icon'];","module.exports = flarum.core.compat['components/WelcomeHero'];","module.exports = flarum.core.compat['components/Select'];","module.exports = flarum.core.compat['components/SelectDropdown'];","module.exports = flarum.core.compat['components/EventPost'];","module.exports = flarum.core.compat['components/SessionDropdown'];","export * from './src/common';\r\nexport * from './src/forum';"],"sourceRoot":""}